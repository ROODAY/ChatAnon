<!DOCTYPE html>
<html>
  <head>
    <title>Super Secret Chat</title>
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/jquery.mCustomScrollbar.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/styles.css">
  </head>
  <body>
    <div id="header">
        <h1>25.13.12.125:3000</h1>
        <h3><span id="users"></span> Users Connected</h3>
    </div>
    <div id="messageblock">
        <ul id="messages"></ul>
    </div>
    <div id="send">
        <form action="">
          <input id="m" autocomplete="off" /><button class="button button-rounded button-flat-primary">Send</button>
        </form>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="js/buttons.js"></script>
    <script>
    	var socket = io();
        var localID = 0;
        var data = {};
        var localscroll = 100;
        function checkScroll(scroll) {
            if (scroll >= 80) {
                $("#messageblock").mCustomScrollbar("scrollTo","bottom", {
                    scrollInertia:1
                });
            }
        }
        socket.on('localID', function(id) {
            localID = id;
        });
        socket.on('senddata', function(arg){
            data = arg;
            $('#users').html(arg.totalUsers);
        });
    	$('form').submit(function(){
    		socket.emit('chat message', $('#m').val(), localID);
    		$('#m').val('');
            checkScroll(localscroll);
    		return false;
    	});
    	socket.on('chat message', function(msg, id){
            if (msg != "") {
                $('#messages').append($('<li style="color:' + data.users[id] + ';">').text(msg));
                checkScroll(localscroll);
            }
    	});

        (function($){
            $(window).load(function(){
               $("#messageblock").mCustomScrollbar({
                    axis:"y",
                    theme:"dark",
                    callbacks:{
                        whileScrolling:function(){ 
                            localscroll = this.mcs.topPct;
                        }
                    },
                });
            });
        })(jQuery);
    </script>
  </body>
</html>